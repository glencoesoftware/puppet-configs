#!/bin/bash
#
# repo maintenance script
#
branch=${1:-master}
case $branch in
  production)
    branch=master
    ;;
  *)
    branch=$branch
    ;;
esac
confdir=$(puppet --configprint confdir)
confdir=${confdir:=/etc/puppet}
if [ -d "$confdir" ]; then
  (
  cd $confdir &&
    git checkout --force HEAD &&
    git pull --quiet origin $branch &&
    git submodule update --init --recursive
  if (which logger &> /dev/null); then
    logger -t puppet-repomx -p daemon.info -s -- repository updated at $confdir to $branch
  fi
  )
fi
